{% extends "base.html" %}
{% block title %}Convert Image Online - Support for Multiple Formats | Utility WebApp{% endblock %}
{% block meta_description %}Convert images between formats like PNG, JPEG, WEBP, and GIF effortlessly. Our online
converter is fast, free, and supports high-quality conversions.{% endblock %}
{% block content %}
<h1 class="mb-4 h2">üîÑ Convert Image Format</h1>

{% if error %}
<div class="alert alert-danger mb-4">
  <strong>Error:</strong> {{ error }}
</div>
{% endif %}

{% if converted %}
<div class="alert alert-success mb-4">
  <h5 class="alert-heading">‚úÖ Conversion Successful!</h5>
  <hr>
  <div class="row">
    <div class="col-md-6">
      <p class="mb-1"><strong>Original Format:</strong>
        <span class="badge bg-secondary">{{ original_format }}</span>
      </p>
      <p class="mb-1"><strong>Target Format:</strong>
        <span class="badge bg-primary">{{ target_format }}</span>
      </p>
      <p class="mb-1"><strong>Original Size:</strong>
        {% if original_size_mb >= 1 %}
        {{ "%.2f"|format(original_size_mb) }} MB
        {% else %}
        {{ "%.2f"|format(original_size_kb) }} KB
        {% endif %}
      </p>
      <p class="mb-0"><strong>Converted Size:</strong>
        {% if converted_size_mb >= 1 %}
        {{ "%.2f"|format(converted_size_mb) }} MB
        {% else %}
        {{ "%.2f"|format(converted_size_kb) }} KB
        {% endif %}
      </p>
    </div>
  </div>
  <hr>
  <a href="/download/{{ download_name }}" class="btn btn-primary" download>Download Converted Image</a>
  <a href="/convert-image" class="btn btn-secondary">Convert Another Image</a>
</div>
{% endif %}

<form method="POST" enctype="multipart/form-data" class="mb-3">
  <div class="mb-3">
    <label for="image" class="form-label">Select Image File</label>
    <input type="file" class="form-control" name="image" accept="image/*" required>
    <small class="form-text text-muted">Supports JPEG, PNG, GIF, BMP, TIFF, WebP, ICO, and more.</small>
  </div>

  <div class="mb-3">
    <label for="target_format" class="form-label">Target Format</label>
    <select class="form-select" name="target_format" id="target_format" required>
      {% for format_key, format_info in supported_formats.items() %}
      <option value="{{ format_key }}" {% if format_key=='PNG' %}selected{% endif %}>
        {{ format_info.name }} ({{ format_info.ext }})
        {% if format_info.supports_alpha %} - Supports transparency{% endif %}
      </option>
      {% endfor %}
    </select>
    <small class="form-text text-muted">Choose the format you want to convert your image to.</small>
  </div>

  <div class="mb-3" id="quality_group">
    <label for="quality" class="form-label">Quality (for JPEG/WebP) (1‚Äì100)</label>
    <input type="number" class="form-control" name="quality" id="quality" value="95" min="1" max="100">
    <small class="form-text text-muted">Higher quality means larger file size. Only applies to JPEG and WebP
      formats.</small>
  </div>

  <button type="submit" class="btn btn-primary">Convert Image</button>
</form>

<div class="card mt-4">
  <div class="card-header">
    <h5 class="mb-0">Supported Formats</h5>
  </div>
  <div class="card-body">
    <div class="row">
      {% for format_key, format_info in supported_formats.items() %}
      <div class="col-md-4 mb-2">
        <strong>{{ format_info.name }}</strong> ({{ format_info.ext }})
        {% if format_info.supports_alpha %}
        <span class="badge bg-info">Transparency</span>
        {% else %}
        <span class="badge bg-secondary">No Transparency</span>
        {% endif %}
      </div>
      {% endfor %}
    </div>
  </div>
</div>

<div class="mt-4">
  <a href="/" class="btn btn-outline-secondary" aria-label="Back to Home Page">‚Üê Back to Home</a>
</div>

<!-- Related Tools Section -->
<hr class="my-5">
<section class="mb-5 py-4">
  <h3 class="fw-bold mb-4 text-center">More Media Utilities</h3>
  <div class="row g-3">
    <div class="col-md-4">
      <a href="/compress" class="card h-100 text-decoration-none hover-shadow border-0 shadow-sm">
        <div class="card-body text-center p-3">
          <span class="fs-2 mb-2 d-block" role="img" aria-label="Tools">üîß</span>
          <h6 class="card-title mb-0 text-dark font-heading">Image Compression</h6>
        </div>
      </a>
    </div>
    <div class="col-md-4">
      <a href="/remove-background" class="card h-100 text-decoration-none hover-shadow border-0 shadow-sm">
        <div class="card-body text-center p-3">
          <span class="fs-2 mb-2 d-block" role="img" aria-label="Image">üñºÔ∏è</span>
          <h6 class="card-title mb-0 text-dark font-heading">Remove Background</h6>
        </div>
      </a>
    </div>
    <div class="col-md-4">
      <a href="/qr" class="card h-100 text-decoration-none hover-shadow border-0 shadow-sm">
        <div class="card-body text-center p-3">
          <span class="fs-2 mb-2 d-block" role="img" aria-label="Mobile">üì±</span>
          <h6 class="card-title mb-0 text-dark font-heading">QR Generator</h6>
        </div>
      </a>
    </div>
  </div>
</section>

<!-- HowTo Structured Data -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "HowTo",
  "name": "How to Convert Image Formats Online",
  "description": "Quickly convert your images between PNG, JPEG, WEBP, and GIF formats for free.",
  "step": [
    {
      "@type": "HowToStep",
      "name": "Upload Image",
      "text": "Select the image you want to convert from your computer or phone.",
      "url": "{{ request.url }}"
    },
    {
      "@type": "HowToStep",
      "name": "Choose Target Format",
      "text": "Select your desired output format (e.g., JPEG, PNG, WEBP) from the dropdown menu.",
      "url": "{{ request.url }}"
    },
    {
      "@type": "HowToStep",
      "name": "Convert and Download",
      "text": "Click the Convert & Download button to receive your professionally formatted image instantly.",
      "url": "{{ request.url }}"
    }
  ],
  "totalTime": "PT15S"
}
</script>

<script>
  // Show/hide quality input based on selected format
  document.getElementById('target_format').addEventListener('change', function () {
    const selectedFormat = this.value.toUpperCase();
    const qualityGroup = document.getElementById('quality_group');

    if (selectedFormat === 'JPEG' || selectedFormat === 'WEBP') {
      qualityGroup.style.display = 'block';
      document.getElementById('quality').setAttribute('required', 'required');
    } else {
      qualityGroup.style.display = 'none';
      document.getElementById('quality').removeAttribute('required');
    }
  });

  // Initialize on page load
  document.getElementById('target_format').dispatchEvent(new Event('change'));
</script>
{% endblock %}