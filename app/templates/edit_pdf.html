{% extends "base.html" %}
{% block title %}Edit PDF Online - Merge, Split, Rotate, and Extract | Utility WebApp{% endblock %}
{% block meta_description %}Advanced online PDF editor. Merge multiple PDFs, split ranges, rotate pages, or extract
specific pages from your PDF documents for free.{% endblock %}
{% block content %}
<h1 class="mb-4 h2">‚úèÔ∏è Edit Your PDF</h1>

{% if error %}
<div class="alert alert-danger mb-4">
  <strong>Error:</strong> {{ error }}
</div>
{% endif %}

{% if success %}
<div class="alert alert-success mb-4">
  <h5 class="alert-heading">‚úÖ Operation Successful!</h5>
  <hr>
  {% if operation == "merge" %}
  <p class="mb-2"><strong>Merged PDF Size:</strong> {{ "%.2f"|format(file_size / (1024 * 1024)) }} MB</p>
  <a href="/download/{{ download_name }}" class="btn btn-primary" download>Download Merged PDF</a>
  {% elif operation == "split" %}
  <p class="mb-2"><strong>Split Files Created:</strong> {{ filenames|length }}</p>
  {% for filename in filenames %}
  <a href="/download/{{ filename }}" class="btn btn-primary me-2 mb-2" download>Download {{ filename }}</a>
  {% endfor %}
  {% elif operation == "rotate" %}
  <a href="/download/{{ download_name }}" class="btn btn-primary" download>Download Rotated PDF</a>
  {% elif operation == "extract" %}
  <a href="/download/{{ download_name }}" class="btn btn-primary" download>Download Extracted PDF</a>
  {% endif %}
  <hr>
  <a href="/edit-pdf" class="btn btn-secondary">Edit Another PDF</a>
</div>
{% endif %}

<div class="mb-4">
  <label class="form-label"><strong>Select Operation:</strong></label>
  <div class="btn-group" role="group" aria-label="PDF operations">
    <input type="radio" class="btn-check" name="operation" id="merge" value="merge" {% if operation=="merge" or
      operation=="" %}checked{% endif %}>
    <label class="btn btn-outline-primary" for="merge">Merge PDFs</label>

    <input type="radio" class="btn-check" name="operation" id="split" value="split" {% if operation=="split" %}checked{%
      endif %}>
    <label class="btn btn-outline-primary" for="split">Split PDF</label>

    <input type="radio" class="btn-check" name="operation" id="rotate" value="rotate" {% if operation=="rotate"
      %}checked{% endif %}>
    <label class="btn btn-outline-primary" for="rotate">Rotate Pages</label>

    <input type="radio" class="btn-check" name="operation" id="extract" value="extract" {% if operation=="extract"
      %}checked{% endif %}>
    <label class="btn btn-outline-primary" for="extract">Extract Pages</label>
  </div>
</div>

<form method="POST" enctype="multipart/form-data" id="pdfForm">
  <input type="hidden" name="operation" id="operationInput" value="{{ operation if operation else 'merge' }}">

  <!-- Merge PDFs -->
  <div id="mergeSection" class="operation-section">
    <div class="mb-3">
      <label for="pdfs" class="form-label">Select PDF Files to Merge (at least 2)</label>
      <input type="file" class="form-control" name="pdfs" accept=".pdf,application/pdf" multiple required>
      <small class="form-text text-muted">Select multiple PDF files. They will be merged in the order selected.</small>
    </div>
  </div>

  <!-- Split PDF -->
  <div id="splitSection" class="operation-section" style="display: none;">
    <div class="mb-3">
      <label for="pdf_split" class="form-label">Select PDF File</label>
      <input type="file" class="form-control" name="pdf" accept=".pdf,application/pdf" required>
    </div>
    <div class="mb-3">
      <label for="page_ranges" class="form-label">Page Ranges (e.g., 1-3,4-6,7-10)</label>
      <input type="text" class="form-control" name="page_ranges" id="page_ranges" placeholder="1-3,4-6,7-10" required>
      <small class="form-text text-muted">Enter page ranges separated by commas. Each range should be in format
        start-end.</small>
    </div>
  </div>

  <!-- Rotate PDF -->
  <div id="rotateSection" class="operation-section" style="display: none;">
    <div class="mb-3">
      <label for="pdf_rotate" class="form-label">Select PDF File</label>
      <input type="file" class="form-control" name="pdf" accept=".pdf,application/pdf" required>
    </div>
    <div class="mb-3">
      <label for="rotation" class="form-label">Rotation Angle</label>
      <select class="form-select" name="rotation" id="rotation">
        <option value="90">90¬∞ (Clockwise)</option>
        <option value="180">180¬∞ (Upside Down)</option>
        <option value="270">270¬∞ (Counter-clockwise)</option>
      </select>
    </div>
    <div class="mb-3">
      <div class="form-check">
        <input class="form-check-input" type="checkbox" name="use_page_range" id="use_page_range">
        <label class="form-check-label" for="use_page_range">
          Rotate specific pages only
        </label>
      </div>
    </div>
    <div class="mb-3" id="pageRangeFields" style="display: none;">
      <div class="row">
        <div class="col-md-6">
          <label for="start_page" class="form-label">Start Page</label>
          <input type="number" class="form-control" name="start_page" id="start_page" min="1" value="1">
        </div>
        <div class="col-md-6">
          <label for="end_page" class="form-label">End Page</label>
          <input type="number" class="form-control" name="end_page" id="end_page" min="1" value="1">
        </div>
      </div>
    </div>
  </div>

  <!-- Extract Pages -->
  <div id="extractSection" class="operation-section" style="display: none;">
    <div class="mb-3">
      <label for="pdf_extract" class="form-label">Select PDF File</label>
      <input type="file" class="form-control" name="pdf" accept=".pdf,application/pdf" required>
    </div>
    <div class="mb-3">
      <label for="pages" class="form-label">Page Numbers to Extract (e.g., 1,3,5)</label>
      <input type="text" class="form-control" name="pages" id="pages" placeholder="1,3,5" required>
      <small class="form-text text-muted">Enter page numbers separated by commas. Pages are 1-indexed.</small>
    </div>
  </div>

  <button type="submit" class="btn btn-primary" aria-label="Execute Operation">Execute Operation</button>
</form>

<div class="mt-4">
  <a href="/" class="btn btn-outline-secondary" aria-label="Back to Homepage">‚Üê Back to Home</a>
</div>

<hr class="my-5">
<section class="mb-5 py-4">
  <h3 class="fw-bold mb-4 text-center">More PDF Utilities</h3>
  <div class="row g-3">
    <div class="col-md-4">
      <a href="/sign-pdf" class="card h-100 text-decoration-none hover-shadow border-0 shadow-sm">
        <div class="card-body text-center p-3">
          <span class="fs-2 mb-2 d-block" role="img" aria-label="Pen">‚úçÔ∏è</span>
          <h6 class="card-title mb-0 text-dark font-heading">Sign PDF</h6>
        </div>
      </a>
    </div>
    <div class="col-md-4">
      <a href="/compress-pdf" class="card h-100 text-decoration-none hover-shadow border-0 shadow-sm">
        <div class="card-body text-center p-3">
          <span class="fs-2 mb-2 d-block" role="img" aria-label="Shrink">üì¶</span>
          <h6 class="card-title mb-0 text-dark font-heading">Compress PDF</h6>
        </div>
      </a>
    </div>
    <div class="col-md-4">
      <a href="/convert-pdf-doc" class="card h-100 text-decoration-none hover-shadow border-0 shadow-sm">
        <div class="card-body text-center p-3">
          <span class="fs-2 mb-2 d-block" role="img" aria-label="Word">üìù</span>
          <h6 class="card-title mb-0 text-dark font-heading">PDF to Word</h6>
        </div>
      </a>
    </div>
  </div>
</section>

<!-- HowTo Structured Data -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "HowTo",
  "name": "How to Edit, Merge, and Split PDFs Online",
  "description": "Perform advanced PDF operations like merging, splitting, rotating, and extracting pages for free.",
  "step": [
    {
      "@type": "HowToStep",
      "name": "Select Operation",
      "text": "Choose between Merge, Split, Rotate, or Extract pages from the operation menu.",
      "url": "{{ request.url }}"
    },
    {
      "@type": "HowToStep",
      "name": "Upload PDF(s)",
      "text": "Select one or more PDF files depending on your chosen operation.",
      "url": "{{ request.url }}"
    },
    {
      "@type": "HowToStep",
      "name": "Execute & Download",
      "text": "Click Execute Operation and download your modified PDF document immediately.",
      "url": "{{ request.url }}"
    }
  ],
  "totalTime": "PT60S"
}
</script>

<script>
  // Handle operation selection
  document.querySelectorAll('input[name="operation"]').forEach(radio => {
    radio.addEventListener('change', function () {
      const operation = this.value;
      document.getElementById('operationInput').value = operation;

      // Hide all sections
      document.querySelectorAll('.operation-section').forEach(section => {
        section.style.display = 'none';
      });

      // Show selected section
      document.getElementById(operation + 'Section').style.display = 'block';

      // Clear required attributes
      document.querySelectorAll('input[type="file"], input[type="text"]').forEach(input => {
        input.removeAttribute('required');
      });

      // Set required for visible inputs
      const section = document.getElementById(operation + 'Section');
      section.querySelectorAll('input[type="file"], input[type="text"]').forEach(input => {
        input.setAttribute('required', 'required');
      });
    });
  });

  // Handle page range checkbox for rotate
  document.getElementById('use_page_range').addEventListener('change', function () {
    document.getElementById('pageRangeFields').style.display = this.checked ? 'block' : 'none';
  });

  // Initialize on page load
  const checkedOperation = document.querySelector('input[name="operation"]:checked').value;
  document.getElementById('operationInput').value = checkedOperation;
  if (checkedOperation !== 'merge') {
    document.getElementById('mergeSection').style.display = 'none';
    document.getElementById(checkedOperation + 'Section').style.display = 'block';
  }
</script>
{% endblock %}