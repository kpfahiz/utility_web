{% extends "base.html" %}
{% block title %}Edit PDF{% endblock %}
{% block content %}
  <h2 class="mb-4">✏️ Edit Your PDF</h2>
  
  {% if error %}
  <div class="alert alert-danger mb-4">
    <strong>Error:</strong> {{ error }}
  </div>
  {% endif %}
  
  {% if success %}
  <div class="alert alert-success mb-4">
    <h5 class="alert-heading">✅ Operation Successful!</h5>
    <hr>
    {% if operation == "merge" %}
      <p class="mb-2"><strong>Merged PDF Size:</strong> {{ "%.2f"|format(file_size / (1024 * 1024)) }} MB</p>
      <a href="/download/{{ download_name }}" class="btn btn-primary" download>Download Merged PDF</a>
    {% elif operation == "split" %}
      <p class="mb-2"><strong>Split Files Created:</strong> {{ filenames|length }}</p>
      {% for filename in filenames %}
        <a href="/download/{{ filename }}" class="btn btn-primary me-2 mb-2" download>Download {{ filename }}</a>
      {% endfor %}
    {% elif operation == "rotate" %}
      <a href="/download/{{ download_name }}" class="btn btn-primary" download>Download Rotated PDF</a>
    {% elif operation == "extract" %}
      <a href="/download/{{ download_name }}" class="btn btn-primary" download>Download Extracted PDF</a>
    {% endif %}
    <hr>
    <a href="/edit-pdf" class="btn btn-secondary">Edit Another PDF</a>
  </div>
  {% endif %}
  
  <div class="mb-4">
    <label class="form-label"><strong>Select Operation:</strong></label>
    <div class="btn-group" role="group" aria-label="PDF operations">
      <input type="radio" class="btn-check" name="operation" id="merge" value="merge" {% if operation == "merge" or operation == "" %}checked{% endif %}>
      <label class="btn btn-outline-primary" for="merge">Merge PDFs</label>
      
      <input type="radio" class="btn-check" name="operation" id="split" value="split" {% if operation == "split" %}checked{% endif %}>
      <label class="btn btn-outline-primary" for="split">Split PDF</label>
      
      <input type="radio" class="btn-check" name="operation" id="rotate" value="rotate" {% if operation == "rotate" %}checked{% endif %}>
      <label class="btn btn-outline-primary" for="rotate">Rotate Pages</label>
      
      <input type="radio" class="btn-check" name="operation" id="extract" value="extract" {% if operation == "extract" %}checked{% endif %}>
      <label class="btn btn-outline-primary" for="extract">Extract Pages</label>
    </div>
  </div>
  
  <form method="POST" enctype="multipart/form-data" id="pdfForm">
    <input type="hidden" name="operation" id="operationInput" value="{{ operation if operation else 'merge' }}">
    
    <!-- Merge PDFs -->
    <div id="mergeSection" class="operation-section">
      <div class="mb-3">
        <label for="pdfs" class="form-label">Select PDF Files to Merge (at least 2)</label>
        <input type="file" class="form-control" name="pdfs" accept=".pdf,application/pdf" multiple required>
        <small class="form-text text-muted">Select multiple PDF files. They will be merged in the order selected.</small>
      </div>
    </div>
    
    <!-- Split PDF -->
    <div id="splitSection" class="operation-section" style="display: none;">
      <div class="mb-3">
        <label for="pdf_split" class="form-label">Select PDF File</label>
        <input type="file" class="form-control" name="pdf" accept=".pdf,application/pdf" required>
      </div>
      <div class="mb-3">
        <label for="page_ranges" class="form-label">Page Ranges (e.g., 1-3,4-6,7-10)</label>
        <input type="text" class="form-control" name="page_ranges" id="page_ranges" placeholder="1-3,4-6,7-10" required>
        <small class="form-text text-muted">Enter page ranges separated by commas. Each range should be in format start-end.</small>
      </div>
    </div>
    
    <!-- Rotate PDF -->
    <div id="rotateSection" class="operation-section" style="display: none;">
      <div class="mb-3">
        <label for="pdf_rotate" class="form-label">Select PDF File</label>
        <input type="file" class="form-control" name="pdf" accept=".pdf,application/pdf" required>
      </div>
      <div class="mb-3">
        <label for="rotation" class="form-label">Rotation Angle</label>
        <select class="form-select" name="rotation" id="rotation">
          <option value="90">90° (Clockwise)</option>
          <option value="180">180° (Upside Down)</option>
          <option value="270">270° (Counter-clockwise)</option>
        </select>
      </div>
      <div class="mb-3">
        <div class="form-check">
          <input class="form-check-input" type="checkbox" name="use_page_range" id="use_page_range">
          <label class="form-check-label" for="use_page_range">
            Rotate specific pages only
          </label>
        </div>
      </div>
      <div class="mb-3" id="pageRangeFields" style="display: none;">
        <div class="row">
          <div class="col-md-6">
            <label for="start_page" class="form-label">Start Page</label>
            <input type="number" class="form-control" name="start_page" id="start_page" min="1" value="1">
          </div>
          <div class="col-md-6">
            <label for="end_page" class="form-label">End Page</label>
            <input type="number" class="form-control" name="end_page" id="end_page" min="1" value="1">
          </div>
        </div>
      </div>
    </div>
    
    <!-- Extract Pages -->
    <div id="extractSection" class="operation-section" style="display: none;">
      <div class="mb-3">
        <label for="pdf_extract" class="form-label">Select PDF File</label>
        <input type="file" class="form-control" name="pdf" accept=".pdf,application/pdf" required>
      </div>
      <div class="mb-3">
        <label for="pages" class="form-label">Page Numbers to Extract (e.g., 1,3,5)</label>
        <input type="text" class="form-control" name="pages" id="pages" placeholder="1,3,5" required>
        <small class="form-text text-muted">Enter page numbers separated by commas. Pages are 1-indexed.</small>
      </div>
    </div>
    
    <button type="submit" class="btn btn-primary">Execute Operation</button>
  </form>
  
  <div class="mt-4">
    <a href="/" class="btn btn-outline-secondary">← Back to Home</a>
  </div>
  
  <script>
    // Handle operation selection
    document.querySelectorAll('input[name="operation"]').forEach(radio => {
      radio.addEventListener('change', function() {
        const operation = this.value;
        document.getElementById('operationInput').value = operation;
        
        // Hide all sections
        document.querySelectorAll('.operation-section').forEach(section => {
          section.style.display = 'none';
        });
        
        // Show selected section
        document.getElementById(operation + 'Section').style.display = 'block';
        
        // Clear required attributes
        document.querySelectorAll('input[type="file"], input[type="text"]').forEach(input => {
          input.removeAttribute('required');
        });
        
        // Set required for visible inputs
        const section = document.getElementById(operation + 'Section');
        section.querySelectorAll('input[type="file"], input[type="text"]').forEach(input => {
          input.setAttribute('required', 'required');
        });
      });
    });
    
    // Handle page range checkbox for rotate
    document.getElementById('use_page_range').addEventListener('change', function() {
      document.getElementById('pageRangeFields').style.display = this.checked ? 'block' : 'none';
    });
    
    // Initialize on page load
    const checkedOperation = document.querySelector('input[name="operation"]:checked').value;
    document.getElementById('operationInput').value = checkedOperation;
    if (checkedOperation !== 'merge') {
      document.getElementById('mergeSection').style.display = 'none';
      document.getElementById(checkedOperation + 'Section').style.display = 'block';
    }
  </script>
{% endblock %}

